<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Haunted Monitor</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div id="stage">
    <!-- Background ambience (optional) -->
    <video id="bg" playsinline muted loop autoplay preload="auto" src="background.mp4"></video>

    <!-- Pre-reveal jumble overlay -->
    <img id="scrambled" src="scrambled.png" alt=""/>

    <!-- Letter rows -->
    <div id="wordLayer" class="magnet-line"></div>
    <div id="ofLayer"   class="magnet-line"></div>
    <div id="suitLayer" class="magnet-line"></div>

    <!-- Film grain (optional) -->
    <video id="grain"  playsinline muted loop autoplay preload="auto" src="grain.mp4"></video>

    <!-- Glitch burst (optional, plays over everything) -->
    <video id="glitch" playsinline muted preload="auto" src="glitch.mp4"></video>
  </div>

  <!-- Firebase + logic -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
    import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js';

    // ðŸ”§ your Firebase (as provided)
    const firebaseConfig = {
      apiKey: "AIzaSyBrePZ1A0Kux-5kI9IBxWBkFQzaOBnBaA8",
      authDomain: "haunted-monitor.firebaseapp.com",
      databaseURL: "https://haunted-monitor-default-rtdb.firebaseio.com",
      projectId: "haunted-monitor",
      storageBucket: "haunted-monitor.firebasestorage.app",
      messagingSenderId: "469649621539",
      appId: "1:469649621539:web:0200310ee852d37e2de796"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // Elements
    const wordLayer = document.getElementById('wordLayer');
    const ofLayer   = document.getElementById('ofLayer');
    const suitLayer = document.getElementById('suitLayer');
    const scrambled = document.getElementById('scrambled');
    const bg        = document.getElementById('bg');
    const grain     = document.getElementById('grain');
    const glitch    = document.getElementById('glitch');

    // Hide missing optional media gracefully
    [bg, grain, scrambled, glitch].forEach(el => el && el.addEventListener('error', () => (el.style.display='none')));

    // Letter PNGs present?
    let letterPngsOk = true;
    (function checkLetters(){
      const t = new Image();
      t.onload  = () => { letterPngsOk = true; };
      t.onerror = () => { letterPngsOk = false; };
      t.src = 'letters/A.png?cb=' + Math.random();
    })();

    function clear(node){ while(node.firstChild) node.removeChild(node.firstChild); }

    function addCharImage(layer, up){
      const img = document.createElement('img');
      img.src = `letters/${up}.png`;
      img.className = 'magnet';
      img.draggable
